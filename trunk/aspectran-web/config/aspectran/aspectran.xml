<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE aspectran PUBLIC "-//aspectran.com//DTD Aspectran 1.0//EN"
                           "./dtd/aspectran-1.0.dtd">

<aspectran>

	<settings>
		<setting name="transletNameSeparator" value="/"/>
		<setting name="transletNamePatternPrefix" value="test"/>
		<setting name="transletNamePatternSuffix" value=".do"/>
		<setting name="transletNamePattern" value="/test/*.do"/>
		<setting name="transletInterfaceClass" value="com.aspectran.web.activity.WebTranslet"/>
		<setting name="transletIntanceClass" value="com.aspectran.web.activity.AspectranWebTranslet"/>
		<setting name="useNamespaces" value="true"/>
		<setting name="nullableContentId" value="true"/>
		<setting name="nullableActionId" value="true"/>
		<setting name="multipleTransletEnable" value="true"/>
	</settings>
	
	<aspect id="requestRule">
		<joinpoint target="request"/>
		<settings>
			<setting name="characterEncoding" value="utf-8"/>
			<setting name="multipart.maxRequestSize" value="10M"/>
			<setting name="multipart.temporaryFilePath" value="/d:/"/>
		</settings>
		<before>
			<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
				<properties>
					<item name="variable1">error</item>
					<item name="variable2">0001</item>
				</properties>
			</action>
		</before>
		<after>
			<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
				<properties>
					<item name="variable1">error</item>
					<item name="variable2">0001</item>
				</properties>
			</action>
			<dispatch id="jsp" contentType="text/html">
				<template>/WEB-INF/jsp/hello.jsp</template>
			</dispatch>
		</after>
	</aspect>
	
	<aspect id="frontRequestRule">
		<joinpoint target="request">
			<pointcut>front/*</pointcut>
		</joinpoint>
		<before>
			<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
				<properties>
					<item name="variable1">error</item>
					<item name="variable2">0001</item>
				</properties>
			</action>
		</before>
		<after>
			<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
				<properties>
					<item name="variable1">error</item>
					<item name="variable2">0001</item>
				</properties>
			</action>
			<dispatch id="jsp" contentType="text/html">
				<template>/WEB-INF/jsp/hello.jsp</template>
			</dispatch>
		</after>
	</aspect>

	<aspect id="responseRule">
		<joinpoint target="response"/>
		<settings>
			<setting name="characterEncoding" value="utf-8"/>
			<setting name="defaultContentType" value="text/html"/>
			<setting name="viewDispatcher" value="org.jhlabs.translets.web.JspViewDispatcher"/>
		</settings>
	</aspect>

	<aspect id="bean1">
		<joinpoint target="bean">
			<pointcut>front/*</pointcut>
		</joinpoint>
		<around>
			<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
				<properties>
					<item name="variable1">error</item>
					<item name="variable2">0001</item>
				</properties>
			</action>
		</around>
	</aspect>

	<!--
		before: access logging
		after: error logging 
	-->
	<aspect id="logging">
		<joinpoint target="action">
			<pointcut>front.action1</pointcut>
		</joinpoint>
		<before>
			<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
				<properties>
					<item name="variable1">error</item>
					<item name="variable2">0001</item>
				</properties>
			</action>
		</before>
		<after>
			<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
				<properties>
					<item name="variable1">error</item>
					<item name="variable2">0001</item>
				</properties>
			</action>
			<dispatch id="jsp" contentType="text/html">
				<template>/WEB-INF/jsp/hello.jsp</template>
			</dispatch>
		</after>
	</aspect>

	<!--
		scheduler
	-->
	<aspect id="scheduler1">
		<joinpoint target="scheduler">
			<pointcut>* * 10 0</pointcut>
		</joinpoint>
		<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
			<properties>
				<item name="variable1">error</item>
				<item name="variable2">0001</item>
			</properties>
		</action>
		<action id="xml" bean="common.action.a1" method="testXmlAction" hidden="true">
			<properties>
				<item name="variable1">error</item>
				<item name="variable2">0001</item>
			</properties>
		</action>
	</aspect>

	<!--
		Matching targets:
			request: reserved
			response: reserved
			bean: each time it is called
			translet: each time it is called
			action: each time it is called
		getAspectObject:
			a return object of <before> action.
	-->
	<aspect id="sqlmap">
		<joinpoint target="translet">
			<pointcut>
				front/a/*
				exclude(front/a/A*)
			</pointcut>
		</joinpoint>
		<before>
			<action bean="common.ticket.t1" method="begin">
				<arguments>
					<item name="stmtId">aaaaaaa</item>
				</arguments>
			</action>
		</before>
		<after>
			<action bean="common.ticket.t1" method="end">
				<arguments>
					<item name="stmtId">aaaaaaa</item>
				</arguments>
			</action>
		</after>
	</aspect>
	
	<bean id="aaa" class="org.jhlabs.translets.test*..*" scope="singleton"/>

	<import resource="ticket-rule.xml"/>
	<import resource="exception-rule.xml"/>
	<import resource="front-translets.xml"/>
	<import resource="ajax-translets.xml"/>
	
</aspectran>